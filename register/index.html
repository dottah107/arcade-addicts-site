<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register | Arcade Addicts</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <meta name="description" content="Sign up for Arcade Addicts tournaments. Warzone, Tekken 8, and MK1." />
  <style>
    :root{ --bg:#000; --panel:#0f0f0f; --panel-2:#111; --text:#fff; --accent:#0ff; --muted:#1a1a1a; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    a{color:inherit;text-decoration:none}
    header{background:var(--panel);padding:20px;border-bottom:3px solid var(--accent);display:flex;justify-content:space-between;align-items:center}
    header h1{display:flex;align-items:center;gap:10px;margin:0;font-family:'Press Start 2P',cursive;color:var(--accent);font-size:1.1rem}
    header h1 .logo{height:28px;width:auto;display:block;filter: drop-shadow(0 0 6px rgba(0,255,255,.55));}
    @media (max-width:640px){ header h1 .logo{height:24px} }
    main{max-width:900px;margin:40px auto;padding:0 20px}
    h2{color:var(--accent);font-size:1.6rem;margin:0 0 14px}
    p.muted{opacity:.85;margin-top:0}
    form{background:var(--panel-2);padding:20px;border-radius:12px;border:1px solid #1b1b1b}
    .row{display:grid;gap:14px;grid-template-columns:1fr 1fr}
    .row .col{display:flex;flex-direction:column}
    label{font-weight:700;margin-bottom:6px}
    input, select, textarea{background:#0b0b0b;color:#fff;border:1px solid #222;border-radius:10px;padding:12px}
    textarea{min-height:90px;resize:vertical}
    .full{grid-column:1/-1}
    .btn{display:inline-block;background:var(--accent);color:#000;border:none;padding:12px 22px;font-size:1rem;font-weight:700;cursor:pointer;border-radius:10px;margin-top:6px}
    .btn:hover{filter:brightness(.9)}
    footer{text-align:center;padding:20px;font-size:.85rem;color:#bbb}
    @media (max-width:720px){ .row{grid-template-columns:1fr} }
    .note{font-size:.9rem;opacity:.8;margin-top:8px}
    #regMsg{margin:10px 0;font-weight:700}
  </style>
</head>
<body>
  <header>
    <a href="/" aria-label="Back to home">← Home</a>
    <h1><img src="/assets/logo.png" alt="" class="logo"> Register</h1>
    <span></span>
  </header>

  <main>
    <h2>Register an Account</h2>

    <p id="aa-msg" class="note"></p>

    <form id="reg" novalidate>
      <!-- (These hidden fields can stay; they won’t be used now that we handle signup in JS) -->
      <input type="hidden" name="_subject" value="New Arcade Addicts registration (with credentials)">
      <input type="hidden" name="_template" value="table">
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_next" value="/register/success.html">
      <input type="hidden" name="_subject" value="Tournament Registration">
      <input type="hidden" name="_autoresponse" value="Thanks for registering with Arcade Addicts — you’re in!">
      <input type="hidden" name="_captcha" value="false">

      <div id="regMsg" class="note"></div>

      <div class="row">
        <div class="col"><label for="name">Full name</label><input id="name" name="Name" autocomplete="name" required></div>
        <div class="col"><label for="gamer">Gamer tag</label><input id="gamer" name="GamerTag" autocomplete="nickname"></div>
        <div class="col"><label for="email">Email</label><input id="email" type="email" name="Email" autocomplete="email" required></div>
        <div class="col"><label for="password">Password</label><input id="password" type="password" name="Password" minlength="6" autocomplete="new-password" required></div>
        <div class="col"><label for="discord">Discord</label><input id="discord" name="Discord" placeholder="username#0000"></div>
        <div class="col"><label for="game">Tournament</label>
          <select id="game" name="Tournament" required>
            <option value="Warzone">COD: Warzone</option>
            <option value="Tekken 8">Tekken 8</option>
            <option value="Mortal Kombat 1">Mortal Kombat 1</option>
          </select></div>
        <div class="col"><label for="platform">Platform</label>
          <select id="platform" name="Platform" required>
            <option>PC</option><option>PlayStation</option><option>Xbox</option><option>Switch</option>
          </select></div>
        <div class="col"><label for="team">Team size</label>
          <select id="team" name="TeamSize">
            <option>Solo</option><option>Duo</option><option>Trio</option><option>Squad</option>
          </select></div>
        <div class="col"><label for="region">Region</label>
          <select id="region" name="Region"><option>NA</option><option>EU</option><option>APAC</option><option>LATAM</option></select></div>
        <div class="col full"><label for="notes">Notes</label><textarea id="notes" name="Notes" placeholder="Anything we should know?"></textarea></div>
      </div>

      <p class="note">After you register, check your email to verify, then log in.</p>
      <button class="btn" type="submit">Register</button>
    </form>
  </main>

  <footer>&copy; 2025 Arcade Addicts</footer>

  <!-- Keep your existing “pick tournament from ?t=” logic -->
  <script>
    const t=new URLSearchParams(location.search).get("t");
    const map1={MK1:"Mortal Kombat 1","Tekken 8":"Tekken 8",Warzone:"Warzone","NBA 2K26":"NBA 2K26"};
    document.getElementById("game")?.value=(map1[t]||t||"");
    if (new URLSearchParams(location.search).has("t")) {
      document.querySelector("form")?.scrollIntoView({behavior:"smooth", block:"start"});
      setTimeout(()=>document.getElementById("name")?.focus(), 200);
    }
  </script>
  <script>
    const raw = new URLSearchParams(location.search).get("t") || "";
    const key = raw.toLowerCase().replace(/%20|[\s-]/g,"");
    const map2 = {warzone:"Warzone", tekken8:"Tekken 8", mk1:"Mortal Kombat 1", nba2k26:"NBA 2K26"};
    document.getElementById("game")?.value = map2[key] || raw;
  </script>

  <!-- Supabase SDK (local) -->
  <script src="/assets/vendor/supabase.min.js?v=reg4"></script>

  <!-- Page-only signup wiring -->
  <script>
  (function(){
    const URL='https://xvhkwyhncuivsfwfmvbg.supabase.co';
    const KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2aGt3eWhuY3VpdnNmd2ZtdmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MzQxNjgsImV4cCI6MjA3NDQxMDE2OH0.oeCz6LHCCzLvHqO7q9cNiiiotrUm8kzmzdJjfzBIA-8';

    function $(s, r=document){ return r.querySelector(s); }
    function msg(str, ok=false){
      const el = $("#regMsg"); if (!el) return;
      el.style.color = ok ? "#86efac" : "#fca5a5";
      el.textContent = str || "";
    }

    function ready(fn){ if (document.readyState==="loading") document.addEventListener("DOMContentLoaded", fn); else fn(); }
    ready(()=>{
      if (!window.supabase) { msg("Missing Supabase SDK"); return; }
      const sb = supabase.createClient(URL, KEY);

      const form = $("#reg");
      if (!form) return;

      // prevent native nav (stops the raw letters/weird page)
      form.setAttribute("action", "");
      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        msg("");

        const email = $("#email")?.value?.trim() || "";
        const password = $("#password")?.value || "";
        if (!email || !password){ msg("Enter email and password."); return; }

        const btn = form.querySelector('button[type="submit"],input[type="submit"]');
        const old = btn?.innerText || btn?.value;
        if (btn){ btn.disabled = true; if ("innerText" in btn) btn.innerText = "Registering..."; else btn.value = "Registering..."; }

        try {
          const redirectUrl = location.origin + "/login/?email=1";
          const { error } = await sb.auth.signUp({
            email, password,
            options: { emailRedirectTo: redirectUrl }
          });
          if (error){ msg(error.message); return; }

          msg("Check your email to verify your account.", true);
          setTimeout(()=>{ location.href = "/login/?email=1"; }, 1200);
        } catch(err){
          msg(err?.message || "Could not register.");
        } finally {
          if (btn){ btn.disabled = false; if ("innerText" in btn) btn.innerText = old; else btn.value = old; }
        }
      });
    });
  })();
  </script>
</body>
</html>

<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Change Password • Arcade Addicts</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#000;--surface:#0f0f0f;--muted:#161616;--accent:#00FFFF;--text:#fff;--radius:14px}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#000;color:#fff}
.wrap{max-width:520px;margin:70px auto;padding:0 16px}
.card{background:var(--surface);border:1px solid var(--muted);border-radius:var(--radius);padding:18px}
h1{margin:0 0 12px;color:var(--accent)}
label{display:block;margin:10px 0 6px;font-weight:600}
input{width:100%;padding:12px;border-radius:10px;border:1px solid #222;background:#0b0b0b;color:#fff}
.btn{width:100%;margin-top:12px;padding:12px;border-radius:12px;font-weight:800;border:none;cursor:pointer;background:var(--accent);color:#000}
.muted{opacity:.85}
#status{margin:10px 0 0;min-height:1.2em;color:#f99;font-weight:600}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head><body>
<div class="wrap">
  <h1>Set a new password</h1>
  <div id="status"></div>
  <form id="setpw" class="card" style="display:none">
    <label for="pw">New password (min 6)</label>
    <input id="pw" type="password" minlength="6" required>
    <label for="pw2">Confirm password</label>
    <input id="pw2" type="password" minlength="6" required>
    <button id="save" class="btn">Save password</button>
  </form>
  <div id="needlink" class="card" style="display:none">
    <p>You opened this page directly. Use the reset link sent to your email, then you’ll see this form.</p>
    <p class="muted"><a href="/login/" style="color:var(--accent)">Back to login</a></p>
  </div>
</div>
<script>
const sb  = supabase.createClient('https://xvhkwyhncuivsfwfmvbg.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2aGt3eWhuY3VpdnNmd2ZtdmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MzQxNjgsImV4cCI6MjA3NDQxMDE2OH0.oeCz6LHCCzLvHqO7q9cNiiiotrUm8kzmzdJjfzBIA-8');
const $   = (id)=>document.getElementById(id);
const msg = (t)=>{ const el=$('status'); if(el) el.textContent = t||''; };

(async ()=>{
  const hash = location.hash || '';
  const p = new URLSearchParams(hash.replace(/^#/, ''));
  const type = p.get('type');
  const at = p.get('access_token');
  const rt = p.get('refresh_token');

  if (type === 'recovery' && at && rt){
    try{
      await sb.auth.setSession({ access_token: at, refresh_token: rt });
      $('setpw').style.display = '';
    }catch(e){
      msg(e.message || 'Could not open reset session.');
      $('needlink').style.display = '';
    }
  } else {
    $('needlink').style.display = '';
  }

  const save = $('save');
  if (save){
    save.onclick = async (e)=>{
      e.preventDefault();
      const pw  = $('pw').value || '';
      const pw2 = $('pw2').value || '';
      if (pw.length < 6){ msg('Password must be at least 6 characters.'); return; }
      if (pw !== pw2){ msg('Passwords do not match.'); return; }
      const { error } = await sb.auth.updateUser({ password: pw });
      if (error){ msg(error.message); return; }
      msg('Password updated. Redirecting…');
      setTimeout(()=>location.href='/login/', 900);
    };
  }
})();
</script>
</body></html>
